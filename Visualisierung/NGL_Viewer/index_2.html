<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NGL Interactive Viewer of Holostructure </title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: #202020;
      font-family: Arial, sans-serif;
    }
    #viewport {
      width: 100%;
      height: 100%;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 5px;
    }
    #controls label, #controls select, #controls button {
      margin: 5px 0;
      display: block;
    }
  </style>
</head>
<body>

  <!-- Container für NGL Viewer -->
  <div id="viewport"></div>

  <!-- GUI Controls -->
  <div id="controls">
    <label for="colorSchemeSelector">Color Scheme:</label>
    <select id="colorSchemeSelector">
      <option value="atomindex">atomindex</option>
      <option value="bfactor">bfactor</option>
      <option value="chainid">chainid</option>
      <option value="chainindex">chainindex</option>
      <option value="chainname">chainname</option>
      <option value="densityfit">densityfit</option>
      <option value="electrostatic">electrostatic</option>
      <option value="element">element</option>
      <option value="entityindex">entityindex</option>
      <option value="entitytype">entitytype</option>
      <option value="geoquality">geoquality</option>
      <option value="hydrophobicity">hydrophobicity</option>
      <option value="modelindex">modelindex</option>
      <option value="moleculetype">moleculetype</option>
      <option value="occupancy">occupancy</option>
      <option value="random">random</option>
      <option value="residueindex">residueindex</option>
      <option value="resname">resname</option>
      <option value="sstruc">sstruc</option>
      <option value="uniform">uniform</option>
      <option value="value">value</option>
      <option value="volume">volume</option>
    </select>

    <button id="cartoonBtn">Show Cartoon</button>
    <button id="ballStickBtn">Show Ball+Stick</button>
  </div>

  <!-- NGL Library -->
  <script src="./ngl.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {

        const pdbId = prompt("Enter the PDB of your desired holostructure:");
      document.title = `NGL Interactive Viewer of Holostructure ${pdbId}`;

            // NGL Stage erstellen
      const stage = new NGL.Stage("viewport");
      window.addEventListener("resize", () => stage.handleResize(), false);

      let proteinRep; // Protein Cartoon Repräsentation
      let atom1 = null; // Für Interaktion
      let atom2 = null;


      // Protein & Liganden laden
      
      stage.loadFile(`rcsb://${pdbId}`).then(function(o) {
        proteinRep = o.addRepresentation("cartoon", { colorScheme: "resname" });
        o.addRepresentation("ball+stick", { sele: "hetero", color: "element", scale: 2.0 });
        o.addRepresentation("ball+stick", { sele: "water", color: "#0088FF", scale: 0.1 });
        o.autoView();
      });

      // Dropdown für Farbmodus
    document.getElementById("colorSchemeSelector").addEventListener("change", () => {
        stage.eachComponent(c => {
        c.removeAllRepresentations();
        proteinRep = c.addRepresentation("cartoon", { colorScheme: document.getElementById("colorSchemeSelector").value });
        c.addRepresentation("ball+stick", { sele:"hetero", color:"element", scale:2.0 });
      c.addRepresentation("ball+stick", { sele: "water", color: "#0088FF", scale: 0.1 });
    });
});

      // Buttons für Darstellung
      document.getElementById("cartoonBtn").addEventListener("click", () => {
        stage.eachComponent(c => {
          c.removeAllRepresentations();
          proteinRep = c.addRepresentation("cartoon", { colorScheme: document.getElementById("colorSchemeSelector").value });
          c.addRepresentation("ball+stick", { sele:"hetero", color:"element", scale:2.0 });
         c.addRepresentation("ball+stick", { sele: "water", color: "#0088FF", scale: 0.1 });
        });
      });

      document.getElementById("ballStickBtn").addEventListener("click", () => {
        stage.eachComponent(c => {
          c.removeAllRepresentations();
          c.addRepresentation("ball+stick", { sele:"protein", color:"residueindex" });
          c.addRepresentation("ball+stick", { sele:"hetero", color:"element", scale:2.0 });
          c.addRepresentation("ball+stick", { sele: "water", color: "#0088FF", scale: 0.1 });
        });
      });

      // Interaktive Atomselektion
      stage.signals.clicked.add(function(pickingProxy){
        if(!pickingProxy.atom) return;

        if(!atom1){
          atom1 = pickingProxy.atom;
          console.log("Atom 1 selected:", atom1.toString());
        } else {
          atom2 = pickingProxy.atom;
          console.log("Atom 2 selected:", atom2.toString());

          // Abstand berechnen
          const dist = atom1.positionToVector3().distanceTo(atom2.positionToVector3());
          console.log("Distance:", dist.toFixed(2), "Å");

          // Linie zwischen Atomen
          const shape = new NGL.Shape("interaction");
          shape.addCylinder(atom1.positionToVector3(), atom2.positionToVector3(), [1,0,0], 0.1);
          const shapeComp = stage.addComponentFromObject(shape);
          shapeComp.addRepresentation("buffer");

          // Reset
          atom1 = null;
          atom2 = null;
        }
      });

    });
  </script>
</body>
</html>
